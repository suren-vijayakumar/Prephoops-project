prepHoopsApp.controller("SiteController",["$scope","$http","$location","$modal","siteFullName",function(t,e,r,s,a){t.sites=[],t.dates=[],t.feeds=[],t.authorsWithArticles=[],t.siteName=a.get("siteFullName"),t.authors=[],t.uniqueAuthors=[],t.totalArticles=[],t.dailyAvg=[],t.max=[],t.zeroDays=[],t.arrayMin=function(t){for(var e=t.length,r=1/0;e--;)t[e]<r&&(r=t[e]);return r},t.arrayMax=function(t){for(var e=t.length,r=-(1/0);e--;)t[e]>r&&(r=t[e]);return r},t.getSites=function(e){for(var r=0;r<e.length;r++)for(var s=0;s<e[r].site.length;s++)e[r].site[s].siteName===t.siteName&&t.sites.push(e[r].site[s])},t.getLastParseDate=function(){e.get("/parseRSS/getLastDate").success(function(e){t.clearFields(),t.lastParseDate=new Date(e[0].date);var r=new Date(e[0].date);t.thirtyDaysBefore=new Date(r.setDate(t.lastParseDate.getDate()-7));var s=t.lastParseDate.toISOString();t.shortFirstDateString=s.substr(0,s.indexOf("T"));var a=t.thirtyDaysBefore.toISOString();t.shortSecondDateString=a.substr(0,a.indexOf("T")),t.getThirtyDaysOfArticles(t.shortSecondDateString,t.shortFirstDateString)})},t.getLastParseDate(),t.getThirtyDaysOfArticles=function(r,s){e.post("/api/articleGet",[r,s]).success(function(e){t.getFeeds(),t.dates=e,t.getAllAuthors(e)})},t.$on("siteChanged",function(e,r){t.siteName=r,t.getLastParseDate()}),t.onlyUnique=function(t,e,r){return r.indexOf(t)===e},t.getDayOfWeek=function(e){t.dayOfWeek=e.getDay()},t.getFeeds=function(){e.get("/network/getFeeds").success(function(e){t.feeds=e})},t.getAllAuthors=function(e){for(var r=0;r<e.length;r++)for(var s=0;s<e[r].site.length;s++)if(e[r].site[s].siteName===t.siteName)for(k=0;k<e[r].site[s].articles.length;k++)t.authors.push(e[r].site[s].articles[k].author);t.getUniqueAuthors(e)},t.getUniqueAuthors=function(e){t.uniqueAuthors=t.authors.filter(t.onlyUnique);for(var r=0;r<e.length;r++){t.authorsWithArticles.push({date:e[r].date,authors:[]});for(var s=0;s<t.uniqueAuthors.length;s++)t.authorsWithArticles[r].authors.push({authorName:t.uniqueAuthors[s],articles:[]}),t.totalArticles[s]=0,t.zeroDays[s]=0,t.dailyAvg[s]=0,t.max[s]=0}t.getAuthorArticles(e)},t.getAuthorArticles=function(e){for(var r=0;r<e.length;r++)for(var s=0;s<e[r].site.length;s++)if(e[r].site[s].siteName===t.siteName)for(var a=0;a<t.uniqueAuthors.length;a++)for(var i=0;i<e[r].site[s].articles.length;i++)e[r].site[s].articles[i].author===t.uniqueAuthors[a]&&e[r].date===t.authorsWithArticles[r].date&&t.authorsWithArticles[r].authors[a].articles.push(e[r].site[s].articles[i]);t.getAuthorStats()},t.getAuthorStats=function(){for(var e=0;e<t.authorsWithArticles.length;e++)for(var r=0;r<t.authorsWithArticles[e].authors.length;r++)0===t.authorsWithArticles[e].authors[r].articles.length?t.zeroDays[r]=t.zeroDays[r]+1:(t.totalArticles[r]=t.totalArticles[r]+t.authorsWithArticles[e].authors[r].articles.length,t.dailyAvg[r]=Math.floor(100*t.totalArticles[r]/t.authorsWithArticles.length)/100,t.authorsWithArticles[e].authors[r].articles.length>t.max[r]&&(t.max[r]=t.authorsWithArticles[e].authors[r].articles.length))},t.clearFields=function(){t.sites=[],t.dates=[],t.feeds=[],t.authorsWithArticles=[],t.siteName=a.get("siteFullName"),t.authors=[],t.uniqueAuthors=[],t.totalArticles=[],t.dailyAvg=[],t.max=[],t.zeroDays=[]},t.getRSS=function(r,s){t.clearFields();var a=r.toISOString();t.shortFirstDateString=a.substr(0,a.indexOf("T"));var i=s.toISOString();t.shortSecondDateString=i.substr(0,i.indexOf("T")),e.post("/api/articleGet",[t.shortFirstDateString,t.shortSecondDateString]).success(function(e){t.getFeeds(),t.dates=e,t.sites=e[0].site,t.getAllAuthors(e)})},t.open=function(e,r){e.preventDefault(),e.stopPropagation(),t[r]=!0},t.status={opened:!1},t.today=function(){t.last=new Date,t.first=(new Date).setDate(t.last.getDate()-7)},t.today(),t.clear=function(){t.first=null,t.last=null},t.animationsEnabled=!0,t.openModal=function(e){t.selectedArticles=this.author.articles;s.open({animation:t.animationsEnabled,templateUrl:"/assets/views/routes/authorArticleUrl.html",controller:"ArticleInstanceController",size:e,resolve:{selectedArticles:function(){return t.selectedArticles}}})}}]),prepHoopsApp.controller("ArticleInstanceController",["$scope","$modalInstance","selectedArticles",function(t,e,r){t.modalArticles=r,t.articleUrlArray=[];for(var s=0;s<t.modalArticles.length;s++)t.articleUrlArray.push(t.modalArticles[s].url);t.ok=function(){e.close()}}]);